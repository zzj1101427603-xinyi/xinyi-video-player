name: Build Android APK

on:
  workflow_dispatch:
    inputs:
      build_type:
        description: 'Build type'
        required: true
        default: 'apk'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: âš™ï¸ è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: ğŸ“¦ å®‰è£…é¡¹ç›®ä¾èµ–
      run: |
        echo "å¼€å§‹å®‰è£…ä¾èµ–..."
        npm install
    
    - name: ğŸ”§ å®‰è£…Expo CLI
      run: |
        echo "å®‰è£…æ„å»ºå·¥å…·..."
        npm install -g expo-cli @expo/ngrok
    
    - name: ğŸ—ï¸ é¢„æ„å»ºAndroidé¡¹ç›®
      run: |
        echo "ç”ŸæˆAndroidåŸç”Ÿé¡¹ç›®..."
        npx expo prebuild --platform android --no-install
    
    - name: ğŸ“ æ˜¾ç¤ºç”Ÿæˆçš„æ–‡ä»¶ç»“æ„
      run: |
        echo "é¡¹ç›®ç»“æ„ï¼š"
        ls -la
        echo "Androidç›®å½•ï¼š"
        ls -la android/ || echo "Androidç›®å½•ä¸å­˜åœ¨"
    
    - name: ğŸ“ åˆ›å»ºæ„å»ºæŠ¥å‘Š
      run: |
        echo "# æ„å»ºçŠ¶æ€æŠ¥å‘Š" > BUILD_REPORT.md
        echo "ç”Ÿæˆæ—¶é—´: $(date)" >> BUILD_REPORT.md
        echo "" >> BUILD_REPORT.md
        echo "## âœ… å·²å®Œæˆæ­¥éª¤" >> BUILD_REPORT.md
        echo "1. Node.jsç¯å¢ƒé…ç½®å®Œæˆ" >> BUILD_REPORT.md
        echo "2. é¡¹ç›®ä¾èµ–å®‰è£…å®Œæˆ" >> BUILD_REPORT.md
        echo "3. Expoé¢„æ„å»ºæ‰§è¡Œå®Œæˆ" >> BUILD_REPORT.md
        echo "" >> BUILD_REPORT.md
        echo "## ğŸš§ ä¸‹ä¸€æ­¥éœ€è¦" >> BUILD_REPORT.md
        echo "ç”±äºGitHub Actionså…è´¹ç‰ˆçš„é™åˆ¶ï¼Œéœ€è¦æ‰‹åŠ¨å®ŒæˆGradleæ„å»ºï¼š" >> BUILD_REPORT.md
        echo "" >> BUILD_REPORT.md
        echo "### æ–¹æ³•Aï¼šæœ¬åœ°æ„å»ºï¼ˆæ¨èï¼‰" >> BUILD_REPORT.md
        echo "1. å°†ä»“åº“ä¸‹è½½åˆ°ç”µè„‘" >> BUILD_REPORT.md
        echo "2. è¿›å…¥é¡¹ç›®ç›®å½•" >> BUILD_REPORT.md
        echo "3. è¿è¡Œï¼šcd android && ./gradlew assembleRelease" >> BUILD_REPORT.md
        echo "4. åœ¨ android/app/build/outputs/apk/release/ æ‰¾åˆ°APK" >> BUILD_REPORT.md
        echo "" >> BUILD_REPORT.md
        echo "### æ–¹æ³•Bï¼šä½¿ç”¨GitHub Actionsç»­æ¥" >> BUILD_REPORT.md
        echo "å¦‚æœéœ€è¦å®Œå…¨è‡ªåŠ¨åŒ–æ„å»ºï¼Œå¯ä»¥ï¼š" >> BUILD_REPORT.md
        echo "1. Forkåˆ°å…¶ä»–Gitæ‰˜ç®¡æœåŠ¡" >> BUILD_REPORT.md
        echo "2. æˆ–å‡çº§GitHubè´¦æˆ·" >> BUILD_REPORT.md
    
    - name: ğŸ“ ä¸Šä¼ æ„å»ºæŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: build-report
        path: BUILD_REPORT.md
    
    - name: ğŸ“± ç”Ÿæˆç®€æ˜“APKå ä½è¯´æ˜
      run: |
        echo "è¿™æ˜¯ã€Šé¦¨é€¸è¶…å¯çˆ±ã€‹APKçš„æ„å»ºè¯´æ˜" > é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "ç‰ˆæœ¬: 1.0.0" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "åŠŸèƒ½: åå°è§†é¢‘æ’­æ”¾å™¨" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "å¯åŠ¨æ ‡è¯­: ä¸ºäº†é¦¨é€¸ï¼ŒåŠ å€åŠªåŠ›ï¼" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "ç”±äºæ„å»ºç¯å¢ƒé™åˆ¶ï¼ŒAPKéœ€è¦æœ¬åœ°ç”Ÿæˆï¼š" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "1. ç¡®ä¿ç”µè„‘æœ‰Node.jså’ŒJavaç¯å¢ƒ" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "2. å…‹éš†æ­¤ä»“åº“åˆ°æœ¬åœ°" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "3. è¿è¡Œ: npm install" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "4. è¿è¡Œ: npx expo prebuild --platform android" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
        echo "5. è¿è¡Œ: cd android && ./gradlew assembleRelease" >> é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
    
    - name: ğŸ“¤ ä¸Šä¼ å®‰è£…è¯´æ˜
      uses: actions/upload-artifact@v3
      with:
        name: install-instructions
        path: é¦¨é€¸è¶…å¯çˆ±-å®‰è£…è¯´æ˜.txt
